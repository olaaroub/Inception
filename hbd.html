<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday, Zakaria!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden; /* Hide scrollbars caused by confetti */
        }
        .font-display {
            font-family: 'Playfair Display', serif;
        }
        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        /* Custom animation for the card fade-in */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 1.5s ease-out forwards;
        }
        .poem-fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }

        /* Scratch Card Styles */
        #scratch-card-container {
            position: relative;
            width: 204px; /* Image size + padding + border */
            height: 204px;
            margin: auto;
            cursor: crosshair;
        }
        #scratch-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 9999px;
            z-index: 10;
            transition: opacity 0.5s ease-out;
        }
        #hidden-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            text-align: center;
            z-index: 5;
            opacity: 0;
            transition: opacity 0.8s ease-in 0.3s;
            font-weight: 900; /* Extra bold */
            font-size: 1.8rem; /* Bigger font */
            line-height: 1.2;
            color: #39FF14; /* Electric Lime Green */
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.9); /* Stronger shadow */
            pointer-events: none; /* Allows scratching through text */
        }
        #hidden-message.revealed {
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">
    <canvas id="confetti-canvas"></canvas>

    <div class="w-full max-w-2xl bg-white/10 backdrop-blur-lg rounded-3xl shadow-2xl p-8 md:p-12 text-center fade-in">

        <!-- Header -->
        <h1 class="font-display text-5xl md:text-7xl font-bold text-amber-300 mb-6">
            Happy Birthday, Zakaria!
        </h1>

        <!-- Scratch Card Gift -->
        <h2 class="text-2xl font-bold text-white mb-4">Here is your gift</h2>
        <div id="scratch-card-container">
            <canvas id="scratch-canvas" width="204" height="204"></canvas>
            <div class="p-1.5 rounded-full bg-gradient-to-br from-amber-400 to-pink-500 shadow-xl">
                <img
                    src="https://placehold.co/"
                    class="w-48 h-48 rounded-full object-cover border-4 border-gray-900"
                    <!--
                        HOW TO EDIT THE PHOTO:
                        1. Find a photo URL online or upload one to a site like imgur.com.
                        2. Replace the 'src' link above with your new link.
                    -->
                >
            </div>
            <p id="hidden-message">"Wa ta sir t9wd hhh"</p>
        </div>

        <!-- Heartfelt Message -->
        <div class="text-gray-200 text-lg md:text-xl space-y-4 mt-8">
            <p>
                It's amazing to think that since we were toddlers, we've shared all the stages of life together. From our earliest days to navigating all of life's crazy adventures, you've been there through it all.
            </p>
            <p class="font-bold text-white">
                A friendship that has seen so much is something truly special, and I'm so incredibly grateful for ours.
            </p>
            <p>
                Thank you for all the laughs, the support, and the countless amazing memories. You're not just a friend; you're family.
            </p>
        </div>

        <!-- Gemini API Feature -->
        <div class="my-8">
            <button id="generate-poem-btn" class="bg-amber-400 hover:bg-amber-500 text-gray-900 font-bold py-3 px-6 rounded-full transition duration-300 shadow-lg transform hover:scale-105">
                âœ¨ Create a Birthday Poem
            </button>
            <div id="poem-container" class="mt-6 p-6 bg-black/20 rounded-2xl text-lg text-gray-200" style="display: none; white-space: pre-wrap;">
                <!-- Poem will be injected here -->
            </div>
        </div>

        <!-- Closing Wish -->
        <p class="mt-8 text-2xl font-bold text-amber-300">
            Wishing you a year ahead filled with success, happiness, and more unforgettable memories.
        </p>

        <p class="mt-8 text-lg text-gray-400">
            With all my love,
            <br>
            <span class="text-xl text-white">Oussama</span>
        </p>
    </div>

    <script>
        // --- Confetti Logic ---
        const confettiCanvas = document.getElementById('confetti-canvas');
        const confettiCtx = confettiCanvas.getContext('2d');
        confettiCanvas.width = window.innerWidth;
        confettiCanvas.height = window.innerHeight;
        let particles = [];
        const colors = ['#fde047', '#f97316', '#ec4899', '#8b5cf6', '#3b82f6', '#14b8a6'];

        function createParticle() {
            const x = Math.random() * confettiCanvas.width;
            const y = Math.random() * confettiCanvas.height - confettiCanvas.height;
            const radius = Math.random() * 4 + 2;
            const color = colors[Math.floor(Math.random() * colors.length)];
            const velocity = { x: (Math.random() - 0.5) * 4, y: Math.random() * 3 + 2 };
            particles.push({ x, y, radius, color, velocity });
        }

        function animateConfetti() {
            requestAnimationFrame(animateConfetti);
            confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
            particles.forEach((particle, index) => {
                if (particle.y > confettiCanvas.height) {
                    particles.splice(index, 1);
                } else {
                    particle.velocity.y += 0.04;
                    particle.x += particle.velocity.x;
                    particle.y += particle.velocity.y;
                }
                confettiCtx.beginPath();
                confettiCtx.arc(particle.x, particle.y, particle.radius, 0, Math.PI * 2, false);
                confettiCtx.fillStyle = particle.color;
                confettiCtx.fill();
            });
            if (particles.length < 200) { createParticle(); }
        }
        window.addEventListener('resize', () => {
            confettiCanvas.width = window.innerWidth;
            confettiCanvas.height = window.innerHeight;
        });
        animateConfetti();

        const scratchCanvas = document.getElementById('scratch-canvas');
        const scratchCtx = scratchCanvas.getContext('2d');
        const hiddenMessage = document.getElementById('hidden-message');

        function setupScratchCard() {
            scratchCtx.fillStyle = '#B0B0B0';
            scratchCtx.fillRect(0, 0, scratchCanvas.width, scratchCanvas.height);

            scratchCtx.fillStyle = '#4A5568';
            scratchCtx.font = 'bold 24px Inter';
            scratchCtx.textAlign = 'center';
            scratchCtx.textBaseline = 'middle';
            scratchCtx.fillText('SCRATCH HERE', scratchCanvas.width / 2, scratchCanvas.height / 2);
        }

        let isDrawing = false;

        function getScratchPosition(event) {
            const rect = scratchCanvas.getBoundingClientRect();
            let x, y;
            if (event.touches) {
                x = event.touches[0].clientX - rect.left;
                y = event.touches[0].clientY - rect.top;
            } else {
                x = event.clientX - rect.left;
                y = event.clientY - rect.top;
            }
            return { x, y };
        }

        function scratch(e) {
            if (!isDrawing) return;
            e.preventDefault();
            const { x, y } = getScratchPosition(e);
            scratchCtx.globalCompositeOperation = 'destination-out';
            scratchCtx.beginPath();
            scratchCtx.arc(x, y, 20, 0, Math.PI * 2, false);
            scratchCtx.fill();
        }

        function checkReveal() {
            const pixels = scratchCtx.getImageData(0, 0, scratchCanvas.width, scratchCanvas.height);
            const data = pixels.data;
            let transparentPixels = 0;
            for (let i = 0; i < data.length; i += 4) {
                if (data[i + 3] === 0) {
                    transparentPixels++;
                }
            }
            const percentage = (transparentPixels / (scratchCanvas.width * scratchCanvas.height)) * 100;
            if (percentage > 60) {
                 scratchCanvas.style.opacity = '0';
                 hiddenMessage.classList.add('revealed');
                 scratchCanvas.removeEventListener('mousemove', scratch);
                 scratchCanvas.removeEventListener('touchmove', scratch);
            }
        }

        scratchCanvas.addEventListener('mousedown', (e) => { isDrawing = true; scratch(e); });
        scratchCanvas.addEventListener('touchstart', (e) => { isDrawing = true; scratch(e); });

        scratchCanvas.addEventListener('mousemove', scratch);
        scratchCanvas.addEventListener('touchmove', scratch);

        scratchCanvas.addEventListener('mouseup', () => { isDrawing = false; checkReveal(); });
        scratchCanvas.addEventListener('touchend', () => { isDrawing = false; checkReveal(); });
        scratchCanvas.addEventListener('mouseleave', () => { isDrawing = false; });

        setupScratchCard();


        // --- Gemini API Integration ---
        const generatePoemBtn = document.getElementById('generate-poem-btn');
        const poemContainer = document.getElementById('poem-container');

        async function fetchWithBackoff(url, options, retries = 3, delay = 1000) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.status === 429 || response.status >= 500) {
                        throw new Error(`Retryable error: ${response.status}`);
                    }
                    return response;
                } catch (error) {
                    if (i === retries - 1) throw error;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
            }
        }


        generatePoemBtn.addEventListener('click', async () => {
            generatePoemBtn.disabled = true;
            generatePoemBtn.textContent = 'Thinking...';
            generatePoemBtn.classList.add('opacity-50', 'cursor-not-allowed');
            poemContainer.style.display = 'block';
            poemContainer.classList.add('poem-fade-in');
            poemContainer.textContent = 'ðŸ“œ Conjuring up some birthday magic...';

            const userQuery = "Write a short, fun, and heartfelt birthday poem for Zakaria from his lifelong friend, Oussama. They have been friends since they were toddlers and have shared all stages of life together. Keep it under 8 lines and make it rhyme.";
            const apiKey = "AIzaSyBpeX6QOblf2QvVQluuIEHx1xUIsfFQsoQ";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
            };

            try {
                const response = await fetchWithBackoff(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }

                const result = await response.json();
                const poem = result.candidates?.[0]?.content?.parts?.[0]?.text;

                if (poem) {
                    poemContainer.textContent = poem;
                    generatePoemBtn.textContent = 'âœ¨ Poem Created!';
                } else {
                    throw new Error("No content received from API.");
                }

            } catch (error) {
                console.error('Error calling Gemini API:', error);
                poemContainer.textContent = 'Oops! The magic words got a little tangled. Please refresh and try again.';
                generatePoemBtn.textContent = 'Error!';
            }
        });
    </script>
</body>
</html>

